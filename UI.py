import tkinter as tk
from tkinter import filedialog
from StaticMalwareAnalysis import StaticMalwareAnalysis
from utils import virustotal_api

# Function to initiate analysis for a selected file
def analyze_file():
    file_path = filedialog.askopenfilename(title="Select Malware Sample")
    if file_path:
        analysis = StaticMalwareAnalysis(file_path)
        analysis.create_directory()
        analysis.get_sha256sum()
        analysis.extract_strings()
        analysis.extractPEINFO()
        analysis.move_malware()
        virustotal_results = virustotal_api(analysis.information['sha256_hash'])
        analysis.set_virustotal_results(virustotal_results)
        analysis.create_pdf()
        result_label.config(text=f"Analysis completed for {analysis.sample_name}", fg="green")
    else:
        result_label.config(text="No file selected.", fg="red")

# Create the main window
window = tk.Tk()
window.title("Static Malware Analysis Tool")
window.geometry("700x500")  # Set the window size

# Create and configure a frame
frame = tk.Frame(window, padx=20, pady=20)
frame.pack()

# Create and configure a label
label = tk.Label(frame, text="Static Malware Analysis Tool", width=40, height=3, font=("Arial", 16))
label.pack()

# Create and configure a button to select a file
select_button = tk.Button(frame, text="Select Malware Sample", command=analyze_file, width=20, height=2, bg="blue", fg="white")
select_button.pack()

# Create and configure a label to display analysis results
result_label = tk.Label(frame, text="", wraplength=600, font=("Arial", 12))
result_label.pack()

# Run the main application loop
window.mainloop()